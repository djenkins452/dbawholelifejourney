{% extends "account/base.html" %}
{% load static %}

{% block title %}Create Account - Whole Life Journey{% endblock %}

{% block extra_head %}
{% if recaptcha_site_key %}
<script src="https://www.google.com/recaptcha/api.js?render={{ recaptcha_site_key }}"></script>
{% endif %}
{% endblock %}

{% block auth_content %}
<h1>Create your account</h1>
<p>Begin your journey to living with clarity and intention.</p>

<form method="post" action="{% url 'account_signup' %}" id="signup-form">
    {% csrf_token %}

    {# Honeypot field - invisible to humans, bots will auto-fill it #}
    <div style="position: absolute; left: -9999px; top: -9999px;" aria-hidden="true">
        <label for="website">Website</label>
        <input type="text" name="website" id="website" autocomplete="off" tabindex="-1">
    </div>

    {# reCAPTCHA v3 token - populated by JavaScript on form submit #}
    <input type="hidden" name="recaptcha_token" id="recaptcha_token">

    <div class="form-group">
        <label for="id_email" class="form-label">Email</label>
        <input 
            type="email" 
            name="email" 
            id="id_email" 
            class="form-input"
            placeholder="you@example.com"
            value="{{ form.email.value|default:'' }}"
            required
            autofocus
        >
        {% if form.email.errors %}
            <p class="form-error">{{ form.email.errors.0 }}</p>
        {% endif %}
    </div>
    
    <div class="form-group">
        <label for="id_password1" class="form-label">Password</label>
        <input 
            type="password" 
            name="password1" 
            id="id_password1" 
            class="form-input"
            placeholder="Create a strong password"
            required
        >
        {% if form.password1.errors %}
            <p class="form-error">{{ form.password1.errors.0 }}</p>
        {% endif %}
        <p class="form-help">At least 8 characters recommended.</p>
    </div>
    
    <div class="form-group">
        <label for="id_password2" class="form-label">Confirm Password</label>
        <input 
            type="password" 
            name="password2" 
            id="id_password2" 
            class="form-input"
            placeholder="Confirm your password"
            required
        >
        {% if form.password2.errors %}
            <p class="form-error">{{ form.password2.errors.0 }}</p>
        {% endif %}
    </div>
    
    <p class="text-sm text-muted mb-4">
        By creating an account, you agree to our 
        <a href="{% url 'core:terms' %}" target="_blank">Terms of Service</a> and 
        <a href="{% url 'core:privacy' %}" target="_blank">Privacy Policy</a>.
    </p>
    
    <button type="submit" class="btn btn-primary" style="width: 100%;">
        Create Account
    </button>
</form>

<p class="auth-link">
    Already have an account? <a href="{% url 'account_login' %}">Sign in</a>
</p>
{% endblock %}

{% block extra_js %}
{% if recaptcha_site_key %}
<script>
document.getElementById('signup-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var form = this;
    grecaptcha.ready(function() {
        grecaptcha.execute('{{ recaptcha_site_key }}', {action: 'signup'}).then(function(token) {
            document.getElementById('recaptcha_token').value = token;
            form.submit();
        });
    });
});
</script>
{% endif %}
{% endblock %}
