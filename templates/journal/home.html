{% extends "base.html" %}
{% load static %}

{% block title %}Journal - Whole Life Journey{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <header class="module-header">
        <div class="header-content">
            <div class="header-icon">üìù</div>
            <div>
                <h1>Journal</h1>
                <p class="header-subtitle">Your space for reflection and growth</p>
            </div>
        </div>
        <a href="{% url 'journal:entry_create' %}" class="btn btn-primary">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            New Entry
        </a>
    </header>
    
    <!-- Stats Row -->
    <section class="stats-row">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total }}</div>
            <div class="stat-label">Total Entries</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.this_week }}</div>
            <div class="stat-label">This Week</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.streak }}</div>
            <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.this_month }}</div>
            <div class="stat-label">This Month</div>
        </div>
    </section>
    
    <!-- Quick Actions -->
    <section class="quick-actions-bar">
        <a href="{% url 'journal:entry_create' %}" class="action-btn action-primary">
            <span class="action-icon">‚úçÔ∏è</span>
            Write Entry
        </a>
        <a href="{% url 'journal:prompt_list' %}" class="action-btn">
            <span class="action-icon">üí°</span>
            Writing Prompts
        </a>
        <a href="{% url 'journal:tag_list' %}" class="action-btn">
            <span class="action-icon">üè∑Ô∏è</span>
            Browse Tags
        </a>
        <a href="{% url 'journal:entry_list' %}?view=calendar" class="action-btn">
            <span class="action-icon">üìÖ</span>
            Calendar View
        </a>
    </section>
    
    <!-- Main Content Grid -->
    <div class="module-grid">
        <!-- Recent Entries -->
        <section class="module-card recent-entries">
            <div class="card-header">
                <h2>Recent Entries</h2>
                <a href="{% url 'journal:entry_list' %}" class="link-subtle">View All ‚Üí</a>
            </div>
            
            {% if recent_entries %}
            <div class="entries-list">
                {% for entry in recent_entries %}
                <a href="{% url 'journal:entry_detail' entry.pk %}" class="entry-item">
                    <div class="entry-date">
                        <span class="date-month">{{ entry.entry_date|date:"M" }}</span>
                        <span class="date-day">{{ entry.entry_date|date:"j" }}</span>
                    </div>
                    <div class="entry-content">
                        <h3 class="entry-title">{{ entry.title }}</h3>
                        {% if entry.mood %}
                        <span class="entry-mood mood-{{ entry.mood }}">{{ entry.get_mood_display }}</span>
                        {% endif %}
                        <p class="entry-preview">{{ entry.body|truncatewords:20 }}</p>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìù</div>
                <p>No journal entries yet.</p>
                <a href="{% url 'journal:entry_create' %}" class="btn btn-primary btn-sm">Write Your First Entry</a>
            </div>
            {% endif %}
        </section>
        
        <!-- Mood Overview -->
        <section class="module-card mood-overview">
            <div class="card-header">
                <h2>Mood This Week</h2>
            </div>
            
            {% if mood_stats %}
            <div class="mood-chart">
                {% for mood in mood_stats %}
                <div class="mood-bar-container">
                    <div class="mood-label">{{ mood.emoji }}</div>
                    <div class="mood-bar-wrapper">
                        <div class="mood-bar" style="width: {{ mood.percentage }}%;"></div>
                    </div>
                    <div class="mood-count">{{ mood.count }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state-small">
                <p class="text-muted">Track your mood with each entry to see patterns here.</p>
            </div>
            {% endif %}
        </section>
        
        <!-- Writing Prompt Suggestion -->
        <section class="module-card prompt-suggestion">
            <div class="card-header">
                <h2>Today's Prompt</h2>
                <a href="{% url 'journal:prompt_list' %}" class="link-subtle">More Prompts ‚Üí</a>
            </div>
            
            {% if suggested_prompt %}
            <div class="prompt-content">
                <p class="prompt-text">"{{ suggested_prompt.text }}"</p>
                <div class="prompt-meta">
                    <span class="prompt-category">{{ suggested_prompt.get_category_display }}</span>
                </div>
                <a href="{% url 'journal:entry_create' %}?prompt={{ suggested_prompt.pk }}" class="btn btn-secondary btn-sm mt-3">
                    Use This Prompt
                </a>
            </div>
            {% else %}
            <div class="empty-state-small">
                <p class="text-muted">No prompts available.</p>
            </div>
            {% endif %}
        </section>
        
        <!-- Tags Cloud -->
        <section class="module-card tags-cloud">
            <div class="card-header">
                <h2>Your Tags</h2>
                <a href="{% url 'journal:tag_list' %}" class="link-subtle">Manage ‚Üí</a>
            </div>
            
            {% if popular_tags %}
            <div class="tags-list">
                {% for tag in popular_tags %}
                <a href="{% url 'journal:entry_list' %}?tag={{ tag.slug }}" class="tag-chip">
                    {{ tag.name }}
                    <span class="tag-count">{{ tag.entry_count }}</span>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state-small">
                <p class="text-muted">Add tags to your entries to organize them.</p>
            </div>
            {% endif %}
        </section>
    </div>
</div>

<style>
/* Module Header */
.module-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-6);
    flex-wrap: wrap;
    gap: var(--space-4);
}

.header-content {
    display: flex;
    align-items: center;
    gap: var(--space-4);
}

.header-icon {
    font-size: 2.5rem;
}

.module-header h1 {
    font-size: var(--font-size-2xl);
    margin: 0;
}

.header-subtitle {
    color: var(--color-text-muted);
    margin: 0;
}

/* Stats Row */
.stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-6);
}

.stat-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--space-4);
    text-align: center;
}

.stat-value {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--color-accent);
}

.stat-label {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-top: var(--space-1);
}

/* Quick Actions Bar */
.quick-actions-bar {
    display: flex;
    gap: var(--space-3);
    margin-bottom: var(--space-6);
    flex-wrap: wrap;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: var(--color-text);
    font-size: var(--font-size-sm);
    transition: all var(--transition-fast);
}

.action-btn:hover {
    border-color: var(--color-accent);
    background: var(--color-background);
}

.action-btn.action-primary {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
}

.action-btn.action-primary:hover {
    filter: brightness(1.1);
}

.action-icon {
    font-size: 1.25rem;
}

/* Module Grid */
.module-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: var(--space-6);
}

.module-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
}

.card-header h2 {
    font-size: var(--font-size-base);
    font-weight: 600;
    margin: 0;
}

.link-subtle {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-decoration: none;
}

.link-subtle:hover {
    color: var(--color-accent);
}

/* Entries List */
.entries-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.entry-item {
    display: flex;
    gap: var(--space-4);
    padding: var(--space-3);
    background: var(--color-background);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.entry-item:hover {
    background: color-mix(in srgb, var(--color-accent) 5%, var(--color-background));
}

.entry-date {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 48px;
    padding: var(--space-2);
    background: var(--color-surface);
    border-radius: var(--radius-md);
}

.date-month {
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    color: var(--color-accent);
    font-weight: 600;
}

.date-day {
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--color-text);
}

.entry-content {
    flex: 1;
}

.entry-title {
    font-size: var(--font-size-base);
    font-weight: 500;
    margin: 0 0 var(--space-1) 0;
    color: var(--color-text);
}

.entry-mood {
    display: inline-block;
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-full);
    background: var(--color-border);
    margin-bottom: var(--space-1);
}

.entry-preview {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin: 0;
    line-height: var(--line-height-relaxed);
}

/* Mood Chart */
.mood-chart {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.mood-bar-container {
    display: flex;
    align-items: center;
    gap: var(--space-2);
}

.mood-label {
    width: 24px;
    text-align: center;
}

.mood-bar-wrapper {
    flex: 1;
    height: 8px;
    background: var(--color-border);
    border-radius: var(--radius-full);
    overflow: hidden;
}

.mood-bar {
    height: 100%;
    background: var(--color-accent);
    border-radius: var(--radius-full);
    transition: width 0.3s ease;
}

.mood-count {
    width: 24px;
    text-align: right;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

/* Prompt Suggestion */
.prompt-content {
    text-align: center;
}

.prompt-text {
    font-size: var(--font-size-lg);
    font-style: italic;
    line-height: var(--line-height-relaxed);
    margin-bottom: var(--space-3);
}

.prompt-category {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Tags Cloud */
.tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
}

.tag-chip {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    padding: var(--space-2) var(--space-3);
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    font-size: var(--font-size-sm);
    text-decoration: none;
    color: var(--color-text);
    transition: all var(--transition-fast);
}

.tag-chip:hover {
    border-color: var(--color-accent);
    background: color-mix(in srgb, var(--color-accent) 10%, var(--color-background));
}

.tag-count {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

/* Empty States */
.empty-state {
    text-align: center;
    padding: var(--space-8) var(--space-4);
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: var(--space-3);
}

.empty-state p {
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
}

.empty-state-small {
    padding: var(--space-4);
    text-align: center;
}

.empty-state-small p {
    margin: 0;
}

/* Responsive */
@media (max-width: 768px) {
    .stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .module-grid {
        grid-template-columns: 1fr;
    }
    
    .quick-actions-bar {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: var(--space-2);
    }
    
    .action-btn {
        flex-shrink: 0;
    }
}
</style>
{% endblock %}
