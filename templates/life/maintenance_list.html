{% extends "base.html" %}

{% block title %}Maintenance Logs - Life{% endblock %}

{% block content %}
<div class="container">
    <nav class="breadcrumb mb-4">
        <a href="{% url 'life:home' %}">Life</a>
        <span>/</span>
        <span>Maintenance</span>
    </nav>

    <div class="page-header">
        <div>
            <h1 class="page-title">Maintenance Logs</h1>
            <p class="page-subtitle">Home repairs, upgrades, and service history</p>
        </div>
        <a href="{% url 'life:maintenance_create' %}" class="btn btn-primary">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Add Log
        </a>
    </div>
    
    <!-- Summary -->
    <div class="summary-bar mb-6">
        <div class="summary-stat">
            <span class="summary-number">{{ logs.count }}</span>
            <span class="summary-label">Total Logs</span>
        </div>
        <div class="summary-stat">
            <span class="summary-number">${{ total_spent|floatformat:0 }}</span>
            <span class="summary-label">Total Spent</span>
        </div>
    </div>
    
    <!-- Upcoming Follow-ups -->
    {% if upcoming_followups %}
    <div class="followups-card mb-6">
        <h3>
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
            Upcoming Follow-ups
        </h3>
        <ul class="followup-list">
            {% for log in upcoming_followups %}
            <li>
                <span class="followup-date">{{ log.follow_up_date|date:"M j" }}</span>
                <a href="{{ log.get_absolute_url }}">{{ log.title }}</a>
                <span class="followup-area">{{ log.area }}</span>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <!-- Filters -->
    <div class="filters-bar mb-6">
        <select onchange="location.href='?type=' + this.value" class="form-select form-select-sm">
            <option value="">All Types</option>
            <option value="repair" {% if request.GET.type == 'repair' %}selected{% endif %}>Repair</option>
            <option value="maintenance" {% if request.GET.type == 'maintenance' %}selected{% endif %}>Maintenance</option>
            <option value="upgrade" {% if request.GET.type == 'upgrade' %}selected{% endif %}>Upgrade</option>
            <option value="service" {% if request.GET.type == 'service' %}selected{% endif %}>Service Visit</option>
            <option value="replacement" {% if request.GET.type == 'replacement' %}selected{% endif %}>Replacement</option>
            <option value="inspection" {% if request.GET.type == 'inspection' %}selected{% endif %}>Inspection</option>
        </select>
        
        <select onchange="location.href='?area=' + this.value" class="form-select form-select-sm">
            <option value="">All Areas</option>
            {% for area in areas %}
            <option value="{{ area }}" {% if request.GET.area == area %}selected{% endif %}>{{ area }}</option>
            {% endfor %}
        </select>
        
        <form method="get" class="search-form">
            <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Search logs..." class="form-input form-input-sm">
        </form>
    </div>
    
    {% if logs %}
    <div class="log-list">
        {% for log in logs %}
        <a href="{{ log.get_absolute_url }}" class="log-card">
            <div class="log-date">
                <span class="log-day">{{ log.date|date:"j" }}</span>
                <span class="log-month">{{ log.date|date:"M" }}</span>
                <span class="log-year">{{ log.date|date:"Y" }}</span>
            </div>
            <div class="log-content">
                <div class="log-header">
                    <h3 class="log-title">{{ log.title }}</h3>
                    <span class="log-type log-type-{{ log.log_type }}">{{ log.get_log_type_display }}</span>
                </div>
                <p class="log-area">{{ log.area }}</p>
                {% if log.provider %}
                <p class="log-provider">{{ log.provider }}</p>
                {% endif %}
            </div>
            <div class="log-meta">
                {% if log.cost %}
                <span class="log-cost">${{ log.cost|floatformat:0 }}</span>
                {% endif %}
                {% if log.follow_up_date %}
                <span class="log-followup">
                    <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    {{ log.follow_up_date|date:"M j" }}
                </span>
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
        </svg>
        <h2>No maintenance logs yet</h2>
        <p>Keep track of home repairs, services, and maintenance.</p>
        <a href="{% url 'life:maintenance_create' %}" class="btn btn-primary">Add Your First Log</a>
    </div>
    {% endif %}
</div>

<style>
.summary-bar {
    display: flex;
    gap: var(--space-6);
}

.summary-stat {
    display: flex;
    flex-direction: column;
}

.summary-number {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--color-accent);
}

.summary-label {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.followups-card {
    background: color-mix(in srgb, var(--color-accent) 10%, transparent);
    border: 1px solid var(--color-accent);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
}

.followups-card h3 {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-sm);
    color: var(--color-accent);
    margin: 0 0 var(--space-3) 0;
}

.followup-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.followup-list li {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2) 0;
}

.followup-date {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--color-accent);
    min-width: 50px;
}

.followup-area {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    margin-left: auto;
}

.filters-bar {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
}

.form-select-sm,
.form-input-sm {
    padding: var(--space-2) var(--space-3);
    font-size: var(--font-size-sm);
}

.search-form {
    flex: 1;
    min-width: 200px;
}

.log-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
}

.log-card {
    display: flex;
    gap: var(--space-4);
    padding: var(--space-4);
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    text-decoration: none;
    color: inherit;
    transition: all var(--transition-fast);
}

.log-card:hover {
    border-color: var(--color-accent);
}

.log-date {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 50px;
    padding: var(--space-2);
    background: var(--color-surface);
    border-radius: var(--radius-md);
}

.log-day {
    font-size: var(--font-size-xl);
    font-weight: 700;
    line-height: 1;
}

.log-month {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-transform: uppercase;
}

.log-year {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

.log-content {
    flex: 1;
}

.log-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-1);
}

.log-title {
    font-size: var(--font-size-base);
    margin: 0;
}

.log-type {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
}

.log-type-repair { background: color-mix(in srgb, var(--color-error) 15%, transparent); color: var(--color-error); }
.log-type-maintenance { background: color-mix(in srgb, #10b981 15%, transparent); color: #10b981; }
.log-type-upgrade { background: color-mix(in srgb, #6366f1 15%, transparent); color: #6366f1; }
.log-type-service { background: color-mix(in srgb, #f59e0b 15%, transparent); color: #f59e0b; }
.log-type-replacement { background: color-mix(in srgb, #ec4899 15%, transparent); color: #ec4899; }
.log-type-inspection { background: color-mix(in srgb, #14b8a6 15%, transparent); color: #14b8a6; }

.log-area {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin: 0;
}

.log-provider {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    margin: var(--space-1) 0 0 0;
}

.log-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: var(--space-1);
}

.log-cost {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-accent);
}

.log-followup {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

.empty-state {
    text-align: center;
    padding: var(--space-12) var(--space-4);
}

.empty-state svg {
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
}

.empty-state h2 {
    margin-bottom: var(--space-2);
}

.empty-state p {
    color: var(--color-text-muted);
    margin-bottom: var(--space-6);
}
</style>
{% endblock %}
