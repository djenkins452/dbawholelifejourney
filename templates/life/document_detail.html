{% extends "base.html" %}

{% block title %}{{ document.title }} - Documents{% endblock %}

{% block content %}
<div class="container">
    <nav class="breadcrumb mb-4">
        <a href="{% url 'life:home' %}">Life</a>
        <span>/</span>
        <a href="{% url 'life:document_list' %}">Documents</a>
        <span>/</span>
        <span>{{ document.title }}</span>
    </nav>
    
    <div class="document-detail">
        <div class="detail-header">
            <div class="header-icon">
                {% if document.file_type == 'pdf' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="9" y1="15" x2="15" y2="15"/>
                </svg>
                {% elif document.file_type == 'image/jpeg' or document.file_type == 'image/png' %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                {% else %}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                </svg>
                {% endif %}
            </div>
            <div class="header-info">
                <h1 class="page-title">{{ document.title }}</h1>
                <p class="document-category">{{ document.get_category_display }}</p>
                
                {% if document.is_expired %}
                <span class="status-badge expired">Expired</span>
                {% elif document.is_expiring_soon %}
                <span class="status-badge expiring">Expiring Soon</span>
                {% endif %}
                
                {% if document.is_archived %}
                <span class="status-badge archived">Archived</span>
                {% endif %}
            </div>
            <div class="detail-actions">
                <a href="{% url 'life:document_download' document.pk %}" class="btn btn-primary">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Download
                </a>
                <a href="{% url 'life:document_update' document.pk %}" class="btn btn-secondary">Edit</a>
                <a href="{% url 'life:document_delete' document.pk %}" class="btn btn-ghost text-error">Delete</a>
            </div>
        </div>
        
        <div class="detail-body">
            <div class="detail-main">
                <!-- File Preview -->
                <section class="preview-section">
                    {% if document.file_type == 'image/jpeg' or document.file_type == 'image/png' %}
                    <img src="{{ document.file.url }}" alt="{{ document.title }}" class="preview-image">
                    {% elif document.file_type == 'pdf' %}
                    <div class="preview-pdf">
                        <iframe src="{{ document.file.url }}" width="100%" height="600px"></iframe>
                    </div>
                    {% else %}
                    <div class="preview-placeholder">
                        <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <p>Preview not available for this file type</p>
                        <a href="{% url 'life:document_download' document.pk %}" class="btn btn-secondary">Download to view</a>
                    </div>
                    {% endif %}
                </section>
                
                {% if document.description %}
                <section class="detail-section">
                    <h2>Description</h2>
                    <p>{{ document.description }}</p>
                </section>
                {% endif %}
                
                {% if document.notes %}
                <section class="detail-section">
                    <h2>Notes</h2>
                    <p>{{ document.notes|linebreaks }}</p>
                </section>
                {% endif %}
            </div>
            
            <aside class="detail-sidebar">
                <div class="sidebar-card">
                    <h3>Details</h3>
                    <dl class="detail-list">
                        <dt>Category</dt>
                        <dd>{{ document.get_category_display }}</dd>
                        
                        <dt>File Size</dt>
                        <dd>{{ document.file_size_display }}</dd>
                        
                        <dt>File Type</dt>
                        <dd>{{ document.file_type|upper }}</dd>
                        
                        {% if document.document_date %}
                        <dt>Document Date</dt>
                        <dd>{{ document.document_date|date:"M j, Y" }}</dd>
                        {% endif %}
                        
                        {% if document.expiration_date %}
                        <dt>Expiration</dt>
                        <dd class="{% if document.is_expired %}text-error{% elif document.is_expiring_soon %}text-warning{% endif %}">
                            {{ document.expiration_date|date:"M j, Y" }}
                        </dd>
                        {% endif %}
                        
                        <dt>Uploaded</dt>
                        <dd>{{ document.created_at|date:"M j, Y" }}</dd>
                    </dl>
                </div>
                
                {% if document.related_inventory_item %}
                <div class="sidebar-card">
                    <h3>Related Item</h3>
                    <a href="{{ document.related_inventory_item.get_absolute_url }}" class="related-link">
                        {{ document.related_inventory_item.name }}
                    </a>
                </div>
                {% endif %}
                
                {% if document.related_pet %}
                <div class="sidebar-card">
                    <h3>Related Pet</h3>
                    <a href="{{ document.related_pet.get_absolute_url }}" class="related-link">
                        {{ document.related_pet.name }}
                    </a>
                </div>
                {% endif %}
            </aside>
        </div>
    </div>
</div>

<style>
.breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.breadcrumb a {
    color: var(--color-accent);
}

.detail-header {
    display: flex;
    gap: var(--space-4);
    align-items: flex-start;
    margin-bottom: var(--space-6);
}

.header-icon {
    width: 64px;
    height: 64px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-surface);
    border-radius: var(--radius-lg);
}

.header-icon svg {
    width: 36px;
    height: 36px;
    color: var(--color-accent);
}

.header-info {
    flex: 1;
}

.document-category {
    color: var(--color-text-muted);
    margin-top: var(--space-1);
}

.status-badge {
    display: inline-block;
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    margin-top: var(--space-2);
    margin-right: var(--space-2);
}

.status-badge.expired {
    background: color-mix(in srgb, var(--color-error) 15%, transparent);
    color: var(--color-error);
}

.status-badge.expiring {
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    color: #b45309;
}

.status-badge.archived {
    background: var(--color-surface);
    color: var(--color-text-muted);
}

.detail-actions {
    display: flex;
    gap: var(--space-2);
}

.detail-body {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: var(--space-6);
}

@media (max-width: 900px) {
    .detail-body {
        grid-template-columns: 1fr;
    }
}

.preview-section {
    margin-bottom: var(--space-6);
}

.preview-image {
    max-width: 100%;
    border-radius: var(--radius-md);
}

.preview-pdf {
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    overflow: hidden;
}

.preview-pdf iframe {
    border: none;
}

.preview-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-12);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    text-align: center;
}

.preview-placeholder svg {
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
}

.preview-placeholder p {
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
}

.detail-section {
    margin-bottom: var(--space-6);
}

.detail-section h2 {
    font-size: var(--font-size-lg);
    margin-bottom: var(--space-3);
}

.sidebar-card {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
    margin-bottom: var(--space-4);
}

.sidebar-card h3 {
    font-size: var(--font-size-base);
    margin: 0 0 var(--space-4) 0;
}

.detail-list {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--space-2) var(--space-4);
    font-size: var(--font-size-sm);
}

.detail-list dt {
    color: var(--color-text-muted);
}

.detail-list dd {
    margin: 0;
}

.text-error { color: var(--color-error); }
.text-warning { color: #f59e0b; }

.related-link {
    display: block;
    padding: var(--space-3);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: var(--color-accent);
}

.related-link:hover {
    background: var(--color-border);
}
</style>
{% endblock %}
