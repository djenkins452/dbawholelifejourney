{% extends "base.html" %}
{% load static %}

{% block title %}{{ entry.food_name }} - Nutrition - Whole Life Journey{% endblock %}

{% block content %}
<div class="container">
    <nav class="breadcrumb mb-4">
        <a href="{% url 'health:home' %}">Health</a>
        <span>/</span>
        <a href="{% url 'health:nutrition_home' %}">Nutrition</a>
        <span>/</span>
        <span>{{ entry.food_name|truncatewords:3 }}</span>
    </nav>

    <div class="page-header">
        <div>
            <h1 class="page-title">{{ entry.food_name }}</h1>
            {% if entry.food_brand %}<p class="page-subtitle">{{ entry.food_brand }}</p>{% endif %}
        </div>
        <div class="page-actions">
            <a href="{% url 'health:food_entry_edit' entry.pk %}" class="btn btn-secondary">Edit</a>
            <form method="post" action="{% url 'health:food_entry_delete' entry.pk %}" class="inline-form" onsubmit="return confirm('Delete this entry?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-text btn-danger">Delete</button>
            </form>
        </div>
    </div>

    <div class="entry-details">
        <div class="detail-card">
            <div class="detail-header">
                <span class="meal-badge">{{ entry.get_meal_type_display }}</span>
                <span class="entry-date">{{ entry.logged_date|date:"l, F j, Y" }}{% if entry.logged_time %} at {{ entry.logged_time|time:"g:i A" }}{% endif %}</span>
            </div>

            <div class="nutrition-grid">
                <div class="nutrition-item calories">
                    <span class="nutrition-value">{{ entry.total_calories|floatformat:0 }}</span>
                    <span class="nutrition-label">Calories</span>
                </div>
                <div class="nutrition-item">
                    <span class="nutrition-value">{{ entry.total_protein_g|floatformat:1 }}g</span>
                    <span class="nutrition-label">Protein</span>
                </div>
                <div class="nutrition-item">
                    <span class="nutrition-value">{{ entry.total_carbohydrates_g|floatformat:1 }}g</span>
                    <span class="nutrition-label">Carbs</span>
                </div>
                <div class="nutrition-item">
                    <span class="nutrition-value">{{ entry.total_fat_g|floatformat:1 }}g</span>
                    <span class="nutrition-label">Fat</span>
                </div>
            </div>

            {% if entry.total_fiber_g or entry.total_sugar_g or entry.total_saturated_fat_g %}
            <div class="nutrition-extra">
                {% if entry.total_fiber_g %}<span class="extra-item">Fiber: {{ entry.total_fiber_g|floatformat:1 }}g</span>{% endif %}
                {% if entry.total_sugar_g %}<span class="extra-item">Sugar: {{ entry.total_sugar_g|floatformat:1 }}g</span>{% endif %}
                {% if entry.total_saturated_fat_g %}<span class="extra-item">Sat. Fat: {{ entry.total_saturated_fat_g|floatformat:1 }}g</span>{% endif %}
            </div>
            {% endif %}

            <div class="serving-info">
                <span>{{ entry.quantity }} x {{ entry.serving_size }} {{ entry.serving_unit }}</span>
            </div>
        </div>

        {% if entry.location or entry.eating_pace or entry.hunger_level_before or entry.fullness_level_after %}
        <div class="context-card">
            <h3>Context</h3>
            <div class="context-grid">
                {% if entry.location %}
                <div class="context-item">
                    <span class="context-label">Location</span>
                    <span class="context-value">{{ entry.get_location_display }}</span>
                </div>
                {% endif %}
                {% if entry.eating_pace %}
                <div class="context-item">
                    <span class="context-label">Eating Pace</span>
                    <span class="context-value">{{ entry.get_eating_pace_display }}</span>
                </div>
                {% endif %}
                {% if entry.hunger_level_before %}
                <div class="context-item">
                    <span class="context-label">Hunger Before</span>
                    <span class="context-value">{{ entry.hunger_level_before }}/5</span>
                </div>
                {% endif %}
                {% if entry.fullness_level_after %}
                <div class="context-item">
                    <span class="context-label">Fullness After</span>
                    <span class="context-value">{{ entry.fullness_level_after }}/5</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% if entry.notes %}
        <div class="notes-card">
            <h3>Notes</h3>
            <p>{{ entry.notes }}</p>
        </div>
        {% endif %}

        <div class="meta-info">
            <span class="meta-item">Source: {{ entry.get_entry_source_display }}</span>
            <span class="meta-item">Logged: {{ entry.created_at|date:"M j, Y g:i A" }}</span>
        </div>
    </div>

    <div class="back-link mt-6">
        <a href="{% url 'health:nutrition_home' %}" class="btn btn-text">&larr; Back to Nutrition</a>
    </div>
</div>

<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-6);
}

.page-actions {
    display: flex;
    gap: var(--space-2);
    align-items: center;
}

.inline-form {
    display: inline;
}

.btn-danger {
    color: var(--color-error, #ef4444);
}

.entry-details {
    max-width: 600px;
}

.detail-card {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
    margin-bottom: var(--space-4);
}

.detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
}

.meal-badge {
    background: color-mix(in srgb, var(--color-accent) 20%, transparent);
    color: var(--color-accent);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    font-weight: 500;
}

.entry-date {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.nutrition-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-4);
}

.nutrition-item {
    text-align: center;
}

.nutrition-item.calories .nutrition-value {
    color: var(--color-accent);
    font-size: var(--font-size-2xl);
}

.nutrition-value {
    display: block;
    font-size: var(--font-size-xl);
    font-weight: 600;
}

.nutrition-label {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

.nutrition-extra {
    display: flex;
    gap: var(--space-4);
    padding: var(--space-3);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-4);
}

.extra-item {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.serving-info {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-align: center;
}

.context-card, .notes-card {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    margin-bottom: var(--space-4);
}

.context-card h3, .notes-card h3 {
    font-size: var(--font-size-md);
    margin-bottom: var(--space-3);
}

.context-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-3);
}

.context-item {
    display: flex;
    flex-direction: column;
}

.context-label {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

.context-value {
    font-weight: 500;
}

.meta-info {
    display: flex;
    gap: var(--space-4);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

@media (max-width: 640px) {
    .nutrition-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .context-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
