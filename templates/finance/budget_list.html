{% extends "base.html" %}

{% block title %}Budgets - Finance - Whole Life Journey{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <h1 class="page-title">Budgets</h1>
            <p class="page-subtitle">{{ current_month|date:"F Y" }}</p>
        </div>
        <a href="{% url 'finance:budget_create' %}" class="btn btn-primary">Add Budget</a>
    </div>

    <!-- Summary -->
    <div class="budget-summary mb-6">
        <div class="summary-card">
            <span class="summary-label">Total Budgeted</span>
            <span class="summary-value">${{ total_budgeted|floatformat:2 }}</span>
        </div>
        <div class="summary-card">
            <span class="summary-label">Total Spent</span>
            <span class="summary-value">${{ total_spent|floatformat:2 }}</span>
        </div>
        <div class="summary-card {% if total_remaining >= 0 %}positive{% else %}negative{% endif %}">
            <span class="summary-label">Remaining</span>
            <span class="summary-value">${{ total_remaining|floatformat:2 }}</span>
        </div>
        <div class="summary-card status-summary">
            <span class="status-item on-track">{{ on_track_count }} on track</span>
            <span class="status-item warning">{{ warning_count }} warning</span>
            <span class="status-item over">{{ over_count }} over</span>
        </div>
    </div>

    {% if budgets %}
    <div class="budget-grid">
        {% for budget in budgets %}
        <div class="budget-card status-{{ budget.health_status }}">
            <div class="budget-header">
                <span class="budget-category">{{ budget.category.name }}</span>
                <span class="budget-status-badge">{{ budget.health_status|title }}</span>
            </div>

            <div class="budget-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ budget.spent_percentage }}%;"></div>
                </div>
                <div class="progress-labels">
                    <span class="spent">${{ budget.spent_amount|floatformat:2 }} spent</span>
                    <span class="budgeted">of ${{ budget.total_budget|floatformat:2 }}</span>
                </div>
            </div>

            <div class="budget-remaining">
                {% if budget.remaining_amount >= 0 %}
                <span class="remaining-value positive">${{ budget.remaining_amount|floatformat:2 }}</span>
                <span class="remaining-label">remaining</span>
                {% else %}
                <span class="remaining-value negative">${{ budget.remaining_amount|floatformat:2|slice:"1:" }}</span>
                <span class="remaining-label">over budget</span>
                {% endif %}
            </div>

            <div class="budget-actions">
                <a href="{% url 'finance:budget_update' budget.pk %}" class="btn btn-secondary btn-sm">Edit</a>
                <a href="{% url 'finance:budget_delete' budget.pk %}" class="btn btn-sm">Delete</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>No budgets for {{ current_month|date:"F Y" }}.</p>
        <a href="{% url 'finance:budget_create' %}" class="btn btn-primary">Create your first budget</a>
    </div>
    {% endif %}
</div>

<style>
.budget-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: var(--space-4);
}

.summary-card {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.summary-label {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.summary-value {
    font-size: var(--font-size-2xl);
    font-weight: 600;
}

.summary-card.positive .summary-value { color: var(--color-success, #10b981); }
.summary-card.negative .summary-value { color: var(--color-error, #ef4444); }

.status-summary {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.status-item {
    font-size: var(--font-size-sm);
}

.status-item.on-track { color: var(--color-success, #10b981); }
.status-item.warning { color: #f59e0b; }
.status-item.over { color: var(--color-error, #ef4444); }

.budget-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-4);
}

.budget-card {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-5);
}

.budget-card.status-on_track {
    border-left: 4px solid var(--color-success, #10b981);
}

.budget-card.status-warning {
    border-left: 4px solid #f59e0b;
}

.budget-card.status-over {
    border-left: 4px solid var(--color-error, #ef4444);
}

.budget-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-4);
}

.budget-category {
    font-weight: 600;
    font-size: var(--font-size-lg);
}

.budget-status-badge {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
}

.status-on_track .budget-status-badge {
    background: color-mix(in srgb, var(--color-success, #10b981) 15%, transparent);
    color: var(--color-success, #10b981);
}

.status-warning .budget-status-badge {
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    color: #f59e0b;
}

.status-over .budget-status-badge {
    background: color-mix(in srgb, var(--color-error, #ef4444) 15%, transparent);
    color: var(--color-error, #ef4444);
}

.budget-progress {
    margin-bottom: var(--space-4);
}

.progress-bar {
    height: 8px;
    background: var(--color-surface);
    border-radius: var(--radius-full);
    overflow: hidden;
    margin-bottom: var(--space-2);
}

.progress-fill {
    height: 100%;
    border-radius: var(--radius-full);
    transition: width 0.3s ease;
}

.status-on_track .progress-fill { background: var(--color-success, #10b981); }
.status-warning .progress-fill { background: #f59e0b; }
.status-over .progress-fill { background: var(--color-error, #ef4444); }

.progress-labels {
    display: flex;
    justify-content: space-between;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.budget-remaining {
    display: flex;
    align-items: baseline;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
}

.remaining-value {
    font-size: var(--font-size-xl);
    font-weight: 600;
}

.remaining-value.positive { color: var(--color-success, #10b981); }
.remaining-value.negative { color: var(--color-error, #ef4444); }

.remaining-label {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.budget-actions {
    display: flex;
    gap: var(--space-2);
}

.empty-state {
    text-align: center;
    padding: var(--space-8);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
}
</style>
{% endblock %}
