{% extends "base.html" %}

{% block title %}Task Intake - Admin Console{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <nav class="breadcrumb">
                <a href="{% url 'admin_console:dashboard' %}">Admin Console</a>
                <span>/</span>
                <a href="{% url 'admin_console:admin_task_list' %}">Task List</a>
                <span>/</span>
                <span>Task Intake</span>
            </nav>
            <h1 class="page-title">Task Intake</h1>
            <p class="page-subtitle">Create a new project task (human entry)</p>
        </div>
    </div>

    {% if show_ready_warning %}
    <div class="alert alert-warning mb-4">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        <div>
            <strong>Ready Queue Warning:</strong> There are currently {{ ready_count }} tasks marked as "ready"
            (threshold: {{ ready_warning_threshold }}). Consider reviewing existing ready tasks before adding more.
        </div>
    </div>
    {% endif %}

    <form method="post" class="admin-form">
        {% csrf_token %}

        <div class="form-section">
            <h2 class="form-section-title">Required Fields</h2>

            <div class="form-group">
                <label for="id_title" class="form-label">Title <span class="required">*</span></label>
                <input type="text" name="title" id="id_title" class="form-input"
                       required maxlength="200"
                       placeholder="e.g., Implement user authentication">
                <p class="form-hint">Short, descriptive title for the task</p>
            </div>

            <div class="form-group">
                <label for="id_description" class="form-label">Description <span class="required">*</span></label>
                <textarea name="description" id="id_description" class="form-textarea" rows="5"
                          required placeholder="Describe the task in detail..."></textarea>
                <p class="form-hint">Full description of what needs to be done</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_phase" class="form-label">Phase <span class="required">*</span></label>
                    <select name="phase" id="id_phase" class="form-input" required>
                        {% if not phases %}
                        <option value="">-- No phases available --</option>
                        {% else %}
                        {% for phase in phases %}
                        <option value="{{ phase.pk }}" {% if active_phase and phase.pk == active_phase.pk %}selected{% endif %}>
                            Phase {{ phase.phase_number }}{% if phase.status == 'in_progress' %} (Active){% endif %}
                        </option>
                        {% endfor %}
                        {% endif %}
                    </select>
                    <p class="form-hint">Select the project phase for this task (required)</p>
                </div>

                <div class="form-group">
                    <label for="id_priority" class="form-label">Priority <span class="required">*</span></label>
                    <select name="priority" id="id_priority" class="form-input" required>
                        <option value="1">1 - Highest</option>
                        <option value="2">2 - High</option>
                        <option value="3" selected>3 - Normal</option>
                        <option value="4">4 - Low</option>
                        <option value="5">5 - Lowest</option>
                    </select>
                    <p class="form-hint">1 = highest priority, 5 = lowest</p>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_status" class="form-label">Status</label>
                    <select name="status" id="id_status" class="form-input">
                        <option value="backlog" selected>Backlog</option>
                        <option value="ready">Ready</option>
                    </select>
                    <p class="form-hint">Tasks default to "Backlog" - mark as "Ready" only when actionable</p>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h2 class="form-section-title">Optional Fields</h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="id_category" class="form-label">Category</label>
                    <select name="category" id="id_category" class="form-input">
                        {% for value, label in category_choices %}
                        <option value="{{ value }}" {% if value == 'feature' %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="id_effort" class="form-label">Effort</label>
                    <select name="effort" id="id_effort" class="form-input">
                        {% for value, label in effort_choices %}
                        <option value="{{ value }}" {% if value == 'M' %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <div class="form-info-box">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <span>Tasks created via this form are automatically marked as "created by: human"</span>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Create Task
            </button>
            <a href="{% url 'admin_console:admin_task_list' %}" class="btn btn-ghost">Cancel</a>
        </div>
    </form>
</div>

<style>
.breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-2);
}

.breadcrumb a {
    color: var(--color-accent);
}

.admin-form {
    max-width: 700px;
}

.form-section {
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
    margin-bottom: var(--space-6);
}

.form-section-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    margin: 0 0 var(--space-4) 0;
    padding-bottom: var(--space-3);
    border-bottom: 1px solid var(--color-border);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
}

@media (max-width: 640px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}

.form-group {
    margin-bottom: var(--space-4);
}

.form-label {
    display: block;
    font-weight: 500;
    margin-bottom: var(--space-2);
}

.required {
    color: var(--color-error, #dc2626);
}

.form-hint {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-top: var(--space-1);
}

.form-actions {
    display: flex;
    gap: var(--space-3);
}

.alert {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
    padding: var(--space-4);
    border-radius: var(--radius-md);
}

.alert-warning {
    background: #fef3c7;
    color: #92400e;
    border: 1px solid #fcd34d;
}

.alert svg {
    flex-shrink: 0;
    margin-top: 2px;
}

.form-info-box {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
}

.form-info-box svg {
    flex-shrink: 0;
    color: var(--color-accent);
}

.mb-4 {
    margin-bottom: var(--space-4);
}
</style>
{% endblock %}
