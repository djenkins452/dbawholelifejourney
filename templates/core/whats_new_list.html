{% extends "base.html" %}

{% block title %}What's New - Whole Life Journey{% endblock %}

{% block content %}
<div class="content-container">
    <nav class="breadcrumb mb-4">
        <a href="{% url 'dashboard:home' %}">Home</a>
        <span>/</span>
        <span>What's New</span>
    </nav>

    <div class="page-header">
        <div>
            <h1 class="page-title">What's New</h1>
            <p class="page-subtitle">Recent updates and improvements to Whole Life Journey</p>
        </div>
    </div>

    {% if release_notes %}
    <div class="whats-new-timeline">
        {% regroup release_notes by release_date|date:"F Y" as notes_by_month %}
        {% for month_group in notes_by_month %}
        <div class="whats-new-month">
            <h2 class="whats-new-month-title">{{ month_group.grouper }}</h2>

            <div class="whats-new-month-items">
                {% for note in month_group.list %}
                <article class="whats-new-card {% if note.is_major %}whats-new-card-major{% endif %}">
                    <div class="whats-new-card-icon">
                        {{ note.get_icon }}
                    </div>
                    <div class="whats-new-card-content">
                        <header class="whats-new-card-header">
                            <h3 class="whats-new-card-title">{{ note.title }}</h3>
                            <div class="whats-new-card-badges">
                                <span class="whats-new-badge badge-{{ note.entry_type }}">
                                    {{ note.get_entry_type_display }}
                                </span>
                                {% if note.is_major %}
                                <span class="whats-new-badge badge-major">Major Update</span>
                                {% endif %}
                            </div>
                        </header>
                        <p class="whats-new-card-description">{{ note.description }}</p>
                        <footer class="whats-new-card-footer">
                            <time class="whats-new-card-date" datetime="{{ note.release_date|date:'Y-m-d' }}">
                                {{ note.release_date|date:"F j, Y" }}
                            </time>
                            {% if note.version %}
                            <span class="whats-new-card-version">v{{ note.version }}</span>
                            {% endif %}
                            {% if note.learn_more_url %}
                            <a href="{{ note.learn_more_url }}" class="whats-new-card-link" target="_blank" rel="noopener">
                                Learn more
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                    <polyline points="15 3 21 3 21 9"/>
                                    <line x1="10" y1="14" x2="21" y2="3"/>
                                </svg>
                            </a>
                            {% endif %}
                        </footer>
                    </div>
                </article>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
    <nav class="pagination" aria-label="Release notes pagination">
        <div class="pagination-info">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </div>
        <div class="pagination-links">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="pagination-link">Previous</a>
            {% endif %}
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="pagination-link">Next</a>
            {% endif %}
        </div>
    </nav>
    {% endif %}

    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="64" height="64">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4"/>
                <path d="M12 8h.01"/>
            </svg>
        </div>
        <h2 class="empty-state-title">No updates yet</h2>
        <p class="empty-state-description">
            Check back later for news about new features and improvements.
        </p>
    </div>
    {% endif %}
</div>

<style>
.whats-new-timeline {
    max-width: 800px;
}

.whats-new-month {
    margin-bottom: var(--space-8);
}

.whats-new-month-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-2);
    border-bottom: 2px solid var(--color-accent);
}

.whats-new-month-items {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.whats-new-card {
    display: flex;
    gap: var(--space-4);
    padding: var(--space-4);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    transition: all var(--transition-fast);
}

.whats-new-card:hover {
    border-color: var(--color-accent);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.whats-new-card-major {
    border-left: 4px solid var(--color-accent);
}

.whats-new-card-icon {
    font-size: 1.5rem;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-background);
    border-radius: var(--radius-md);
    flex-shrink: 0;
}

.whats-new-card-content {
    flex: 1;
    min-width: 0;
}

.whats-new-card-header {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-2);
}

.whats-new-card-title {
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--color-text);
    margin: 0;
}

.whats-new-card-badges {
    display: flex;
    gap: var(--space-2);
}

.whats-new-badge {
    font-size: var(--font-size-xs);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.03em;
}

.whats-new-badge.badge-feature {
    background: color-mix(in srgb, var(--color-accent) 15%, transparent);
    color: var(--color-accent);
}

.whats-new-badge.badge-fix {
    background: color-mix(in srgb, #f59e0b 15%, transparent);
    color: #d97706;
}

.whats-new-badge.badge-enhancement {
    background: color-mix(in srgb, #10b981 15%, transparent);
    color: #059669;
}

.whats-new-badge.badge-security {
    background: color-mix(in srgb, #ef4444 15%, transparent);
    color: #dc2626;
}

.whats-new-badge.badge-major {
    background: color-mix(in srgb, #8b5cf6 15%, transparent);
    color: #7c3aed;
}

.whats-new-card-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    line-height: 1.6;
    margin: 0 0 var(--space-3) 0;
}

.whats-new-card-footer {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
}

.whats-new-card-date {
    display: flex;
    align-items: center;
    gap: var(--space-1);
}

.whats-new-card-version {
    padding: 2px 6px;
    background: var(--color-border);
    border-radius: var(--radius-sm);
}

.whats-new-card-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    color: var(--color-accent);
    text-decoration: none;
    margin-left: auto;
}

.whats-new-card-link:hover {
    text-decoration: underline;
}

/* Empty state */
.empty-state {
    text-align: center;
    padding: var(--space-12);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
}

.empty-state-icon {
    color: var(--color-text-muted);
    margin-bottom: var(--space-4);
}

.empty-state-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--space-2);
}

.empty-state-description {
    color: var(--color-text-muted);
    margin: 0;
}

/* Pagination */
.pagination {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    margin-top: var(--space-6);
}

.pagination-info {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.pagination-links {
    display: flex;
    gap: var(--space-3);
}

.pagination-link {
    padding: var(--space-2) var(--space-4);
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    font-size: var(--font-size-sm);
    transition: all var(--transition-fast);
}

.pagination-link:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
}

@media (max-width: 640px) {
    .whats-new-card {
        flex-direction: column;
        gap: var(--space-3);
    }

    .whats-new-card-icon {
        width: 40px;
        height: 40px;
    }

    .whats-new-card-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .whats-new-card-footer {
        flex-wrap: wrap;
    }

    .whats-new-card-link {
        width: 100%;
        margin-left: 0;
        margin-top: var(--space-2);
    }
}
</style>
{% endblock %}
