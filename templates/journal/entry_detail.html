{% extends "base.html" %}

{% block title %}{{ entry.title }} - Journal - Whole Life Journey{% endblock %}

{% block content %}
<div class="content-container">
    <nav class="breadcrumb mb-4">
        <a href="{% url 'journal:entry_list' %}">Journal</a>
        <span>/</span>
        <span>{{ entry.title|truncatewords:5 }}</span>
    </nav>
    
    <article class="entry-detail">
        <header class="entry-detail-header">
            <div class="entry-detail-meta">
                <time datetime="{{ entry.entry_date|date:'Y-m-d' }}">
                    {{ entry.entry_date|date:"l, F j, Y" }}
                </time>
                {% if entry.mood %}
                    <span class="mood-badge mood-badge-{{ entry.mood }}">
                        {{ entry.mood_emoji }} {{ entry.get_mood_display }}
                    </span>
                {% endif %}
            </div>
            
            <h1 class="entry-detail-title">{{ entry.title }}</h1>
            
            {% if entry.categories.exists or entry.tags.exists %}
                <div class="entry-detail-tags">
                    {% for category in entry.categories.all %}
                        <span class="category-tag">{{ category.name }}</span>
                    {% endfor %}
                    {% for tag in entry.tags.all %}
                        <span class="user-tag" style="--tag-color: {{ tag.color }}">{{ tag.name }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </header>
        
        {% if entry.is_archived %}
            <div class="entry-status-banner archived">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 8v13H3V8M1 3h22v5H1zM10 12h4"/>
                </svg>
                <span>This entry is archived.</span>
                <form method="post" action="{% url 'journal:entry_restore' entry.pk %}" class="inline-form">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-ghost btn-sm">Restore</button>
                </form>
            </div>
        {% endif %}
        
        <div class="entry-detail-body">
            {{ entry.body|linebreaks }}
        </div>
        
        {% if entry.prompt %}
            <div class="entry-prompt-used">
                <p class="prompt-label">Written from prompt:</p>
                <p class="prompt-text">"{{ entry.prompt.text }}"</p>
            </div>
        {% endif %}
        
        <footer class="entry-detail-footer">
            <div class="entry-stats">
                <span>{{ entry.word_count }} word{{ entry.word_count|pluralize }}</span>
                <span>·</span>
                <span>Created {{ entry.created_at|date:"M j, Y" }}</span>
                {% if entry.updated_at != entry.created_at %}
                    <span>·</span>
                    <span>Updated {{ entry.updated_at|date:"M j, Y" }}</span>
                {% endif %}
            </div>
            
            <div class="entry-actions">
                <a href="{% url 'journal:entry_update' entry.pk %}" class="btn btn-secondary">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                    Edit
                </a>
                
                {% if entry.is_active %}
                    <form method="post" action="{% url 'journal:entry_archive' entry.pk %}" class="inline-form" data-confirm-archive>
                        {% csrf_token %}
                        <button type="submit" class="btn btn-ghost">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 8v13H3V8M1 3h22v5H1zM10 12h4"/>
                            </svg>
                            Archive
                        </button>
                    </form>
                {% endif %}
                
                <form method="post" action="{% url 'journal:entry_delete' entry.pk %}" class="inline-form" data-confirm-delete="This will move the entry to Recently Deleted. You have 30 days to restore it.">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-ghost text-error">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Delete
                    </button>
                </form>
            </div>
        </footer>
    </article>
    
    <div class="entry-nav mt-8">
        <a href="{% url 'journal:entry_list' %}" class="btn btn-ghost">
            ← Back to Journal
        </a>
    </div>
</div>

<style>
.entry-detail {
    background: var(--color-background);
}

.entry-detail-header {
    margin-bottom: var(--space-8);
}

.entry-detail-meta {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
}

.entry-detail-title {
    font-size: var(--font-size-3xl);
    margin-bottom: var(--space-4);
}

.entry-detail-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
}

.category-tag {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
    background: var(--color-surface);
    border-radius: var(--radius-sm);
    color: var(--color-text-muted);
}

.user-tag {
    font-size: var(--font-size-xs);
    padding: var(--space-1) var(--space-2);
    background: var(--color-surface);
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--tag-color, var(--color-accent));
}

.entry-status-banner {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-6);
    font-size: var(--font-size-sm);
}

.entry-status-banner.archived {
    background: color-mix(in srgb, var(--color-warning) 10%, transparent);
    color: var(--color-warning);
}

.entry-detail-body {
    font-size: var(--font-size-lg);
    line-height: var(--line-height-relaxed);
    color: var(--color-text);
}

.entry-detail-body p {
    margin-bottom: var(--space-4);
}

.entry-prompt-used {
    margin-top: var(--space-8);
    padding: var(--space-4);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    border-left: 4px solid var(--color-accent);
}

.entry-prompt-used .prompt-label {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-2);
}

.entry-prompt-used .prompt-text {
    font-style: italic;
    margin: 0;
}

.entry-detail-footer {
    margin-top: var(--space-8);
    padding-top: var(--space-6);
    border-top: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-4);
}

.entry-stats {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    display: flex;
    gap: var(--space-2);
}

.entry-actions {
    display: flex;
    gap: var(--space-2);
}

.inline-form {
    display: inline;
}

.text-error {
    color: var(--color-error);
}

@media (max-width: 640px) {
    .entry-detail-footer {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .entry-actions {
        width: 100%;
        justify-content: flex-start;
    }
}
</style>
{% endblock %}
