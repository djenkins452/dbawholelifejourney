{% extends "admin/base.html" %}
{% load static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | Whole Life Journey{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}">Whole Life Journey Admin</a>
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <a href="/admin-console/" style="font-size: 14px; font-weight: normal;">
        &larr; Back to Admin Console
    </a>
    &nbsp;&nbsp;
    <button
        type="button"
        class="admin-header-help-btn"
        id="help-trigger"
        data-help-context="ADMIN_GENERAL"
        data-help-type="admin"
        aria-label="Get admin help for this page"
        title="Admin Help"
        onclick="openHelpModal(); return false;"
    >?</button>
</h1>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/help.css' %}">
<style>
/* Admin header help button - inline with branding */
.admin-header-help-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: #417690;
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    font-size: 14px;
    font-weight: 700;
    font-family: Georgia, serif;
    vertical-align: middle;
    margin-left: 8px;
    text-decoration: none;
}

.admin-header-help-btn:hover {
    background: #205067;
    transform: scale(1.1);
}
</style>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
// Determine admin help context from URL
function getAdminHelpContext() {
    const path = window.location.pathname;

    // Map admin URLs to HELP_CONTEXT_IDs
    if (path.includes('/admin/ai/aipromptconfig/')) return 'ADMIN_AI_PROMPTS';
    if (path.includes('/admin/ai/coachingstyle/')) return 'ADMIN_COACHING_STYLES';
    if (path.includes('/admin/ai/')) return 'ADMIN_AI';
    if (path.includes('/admin/core/siteconfiguration/')) return 'ADMIN_SITE_CONFIG';
    if (path.includes('/admin/core/theme/')) return 'ADMIN_THEMES';
    if (path.includes('/admin/core/choicecategory/')) return 'ADMIN_CHOICE_CATEGORIES';
    if (path.includes('/admin/core/choiceoption/')) return 'ADMIN_CHOICE_OPTIONS';
    if (path.includes('/admin/help/helptopic/')) return 'ADMIN_HELP_TOPICS';
    if (path.includes('/admin/help/adminhelptopic/')) return 'ADMIN_ADMIN_HELP_TOPICS';
    if (path.includes('/admin/users/')) return 'ADMIN_USERS';
    if (path.includes('/admin/journal/')) return 'ADMIN_JOURNAL';
    if (path.includes('/admin/faith/')) return 'ADMIN_FAITH';
    if (path.includes('/admin/health/')) return 'ADMIN_HEALTH';
    if (path === '/admin/' || path === '/admin') return 'ADMIN_DASHBOARD';

    return 'ADMIN_GENERAL';
}
</script>
<script src="{% static 'js/help.js' %}"></script>
{% endblock %}

{% block content %}
{{ block.super }}

<!-- Help Modal -->
<dialog id="help-modal" class="help-modal">
    <div class="help-modal-content">
        <header class="help-modal-header">
            <h2 id="help-modal-title">Admin Help</h2>
            <button type="button" class="help-modal-close" onclick="closeHelpModal()" aria-label="Close help">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </header>

        <div id="help-modal-body" class="help-modal-body">
            <div class="help-loading">
                <div class="help-loading-spinner"></div>
                <p>Loading help...</p>
            </div>
        </div>

        <footer id="help-modal-footer" class="help-modal-footer" hidden>
            <h3>Related Topics</h3>
            <ul id="help-related-topics"></ul>
        </footer>
    </div>
</dialog>

<script>
// Set the admin help context on page load
document.addEventListener('DOMContentLoaded', function() {
    const trigger = document.getElementById('help-trigger');
    if (trigger) {
        trigger.dataset.helpContext = getAdminHelpContext();
    }
});
</script>
{% endblock %}
